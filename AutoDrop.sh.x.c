#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc -f AutoDrop.sh 
#endif

static  char data [] = 
#define      xecc_z	15
#define      xecc	((&data[2]))
	"\246\060\247\121\062\302\321\047\173\232\065\323\025\205\302\325"
	"\251\234"
#define      shll_z	10
#define      shll	((&data[20]))
	"\052\101\344\243\241\106\135\125\107\052\034\045\225\237"
#define      chk1_z	22
#define      chk1	((&data[34]))
	"\023\376\246\100\273\327\003\217\230\123\026\054\167\024\167\322"
	"\113\155\254\201\223\053\320\034"
#define      chk2_z	19
#define      chk2	((&data[59]))
	"\253\232\303\004\051\054\237\146\261\207\206\211\107\322\064\224"
	"\175\147\334\341\330\202\056\107"
#define      tst2_z	19
#define      tst2	((&data[81]))
	"\336\115\323\307\134\316\213\152\106\301\246\246\070\142\251\035"
	"\011\046\131\230\151\117\224\343"
#define      pswd_z	256
#define      pswd	((&data[153]))
	"\065\213\073\137\314\320\377\135\112\050\161\110\035\056\336\310"
	"\310\242\367\020\216\121\007\154\272\127\001\236\115\306\036\202"
	"\121\131\342\036\052\341\174\164\012\355\275\047\034\234\360\345"
	"\077\070\217\140\172\161\235\105\062\345\326\107\233\057\271\154"
	"\023\341\047\025\151\227\341\167\266\375\136\204\031\134\214\347"
	"\225\033\107\017\214\344\124\277\311\053\007\145\132\300\321\155"
	"\242\370\203\013\220\144\203\106\142\341\313\173\076\127\142\323"
	"\163\251\342\377\216\066\277\130\141\307\275\274\207\216\051\052"
	"\206\254\065\027\021\271\135\163\233\051\356\331\200\121\254\363"
	"\372\216\363\210\305\263\340\046\172\236\343\001\054\014\054\263"
	"\271\142\312\313\033\050\076\266\121\055\217\321\177\073\305\171"
	"\312\271\002\217\154\343\266\346\201\231\350\256\246\024\141\140"
	"\166\054\053\222\124\152\110\245\230\330\167\027\024\075\221\336"
	"\366\224\156\142\167\045\111\371\277\061\247\146\106\011\306\274"
	"\065\362\117\211\134\227\057\364\160\246\014\204\343\235\143\332"
	"\061\321\074\250\367\205\242\266\267\112\034\375\124\343\272\211"
	"\325\011\023\062\241\102\047\021\351\063\226\315\320\371\247\001"
	"\313\344\252\303\152\115\171\041\227\226\037\353\172\331\165\120"
	"\343\211\202\205\314\251\227\265\334\055\203\255\047\053\256\363"
	"\017\350\365\315\071\374\072\364\123\073\223\241\001\262\044\123"
	"\013\006\161\066\350\355\253\362\333\150\032\367\005\013\334\104"
	"\363"
#define      text_z	1564
#define      text	((&data[468]))
	"\317\114\041\043\207\265\304\211\147\351\334\163\360\115\251\330"
	"\073\125\312\026\276\344\015\303\357\352\010\116\362\005\052\356"
	"\040\260\166\000\256\047\174\032\120\221\076\022\110\353\044\205"
	"\133\023\334\070\074\114\321\020\326\366\143\155\160\002\165\142"
	"\217\260\036\377\075\356\307\364\171\324\025\016\064\070\154\365"
	"\175\016\271\137\014\130\367\106\074\305\235\253\027\133\003\306"
	"\316\347\331\257\246\077\217\136\065\364\100\035\134\071\267\250"
	"\041\262\114\244\105\227\061\131\010\262\024\074\072\040\061\370"
	"\022\077\164\123\005\172\151\257\167\115\145\165\217\312\061\121"
	"\056\300\115\240\105\205\331\135\015\256\357\222\302\040\035\253"
	"\304\327\222\327\116\301\027\223\150\033\254\142\303\377\304\037"
	"\055\062\002\024\030\373\241\236\241\116\214\236\277\032\012\221"
	"\332\173\205\166\321\016\233\262\054\144\221\313\216\277\155\367"
	"\250\366\032\162\310\006\120\053\063\007\355\030\107\326\023\164"
	"\141\322\217\301\107\127\247\324\032\343\162\363\256\166\251\031"
	"\326\122\157\306\100\055\344\360\073\204\340\244\310\137\337\233"
	"\047\375\034\017\330\120\151\025\243\013\363\206\365\013\040\031"
	"\143\105\166\014\142\327\253\173\215\324\267\242\311\167\103\005"
	"\305\145\314\165\216\371\126\106\005\215\276\276\276\316\257\334"
	"\162\270\252\353\101\352\057\253\170\372\152\276\112\370\045\101"
	"\007\157\164\331\207\231\035\356\105\127\173\253\041\361\366\136"
	"\361\003\324\000\123\170\142\124\075\372\233\055\232\316\163\107"
	"\026\150\111\013\105\037\377\226\324\043\057\047\370\241\306\130"
	"\326\324\225\154\166\121\310\104\212\007\334\350\050\024\262\300"
	"\305\125\223\050\255\045\354\051\125\257\342\110\247\070\037\334"
	"\256\011\163\360\072\013\231\136\373\274\302\123\056\233\100\007"
	"\016\314\026\243\050\115\211\261\302\274\024\326\313\223\120\172"
	"\101\331\025\211\241\134\344\212\132\314\354\063\361\266\243\156"
	"\146\300\144\023\367\322\147\177\061\363\122\123\137\036\230\306"
	"\273\205\155\312\146\147\053\107\141\076\157\230\332\265\025\212"
	"\153\261\357\162\166\062\070\322\016\146\237\275\114\024\166\361"
	"\270\250\375\310\375\147\261\174\324\310\353\257\274\273\306\104"
	"\316\323\027\242\202\046\253\301\142\367\354\166\375\275\010\305"
	"\246\103\067\210\260\156\165\113\206\141\166\134\155\130\267\115"
	"\371\222\014\056\342\377\310\160\036\233\072\372\013\312\152\371"
	"\371\122\020\071\072\022\060\005\145\347\111\057\261\332\302\374"
	"\034\365\044\351\333\163\362\133\247\273\327\020\103\315\115\136"
	"\312\265\342\171\036\307\005\177\171\265\245\026\223\247\333\247"
	"\035\317\310\302\276\032\131\066\104\033\204\206\270\246\302\367"
	"\327\354\104\254\371\075\177\044\357\067\023\260\034\317\067\115"
	"\127\301\312\143\077\200\224\320\163\315\066\230\162\275\274\375"
	"\010\117\041\204\142\264\304\345\346\025\016\317\112\153\351\154"
	"\111\367\265\160\311\236\022\251\176\176\171\247\061\022\063\214"
	"\236\201\224\361\364\046\257\234\037\251\133\237\135\070\013\063"
	"\323\110\303\321\203\321\150\362\042\115\140\044\012\251\206\335"
	"\235\173\006\335\010\174\366\276\245\213\066\373\120\335\261\275"
	"\004\142\270\233\155\245\033\156\315\032\044\202\233\320\344\374"
	"\364\062\116\027\241\123\033\012\267\134\126\303\066\121\123\055"
	"\207\240\372\072\067\053\374\033\304\164\244\217\162\357\001\335"
	"\362\213\251\161\020\273\075\342\113\260\244\014\344\143\334\350"
	"\017\153\125\276\307\157\067\244\220\064\110\361\075\201\303\025"
	"\311\346\213\067\352\315\166\342\104\214\055\351\326\352\165\106"
	"\252\052\321\351\202\254\157\266\045\331\040\154\334\104\205\300"
	"\017\022\243\340\202\245\205\006\233\124\135\204\254\000\014\326"
	"\107\306\233\071\334\223\316\011\263\175\326\375\100\103\145\074"
	"\142\305\075\356\066\132\320\267\253\035\371\176\003\166\010\322"
	"\271\136\232\020\105\003\075\333\221\150\226\344\133\222\015\264"
	"\143\255\033\264\305\143\176\150\321\316\270\006\255\046\377\155"
	"\057\206\244\105\056\321\213\352\007\117\152\277\365\242\011\267"
	"\314\314\364\325\050\015\226\353\127\071\056\343\236\167\137\156"
	"\065\330\367\374\273\352\112\350\330\165\243\163\110\134\007\073"
	"\042\102\225\273\370\341\346\356\155\016\173\302\343\060\005\327"
	"\163\030\327\137\211\111\051\320\030\033\365\311\302\101\051\372"
	"\234\147\346\310\257\266\005\072\020\126\320\133\212\142\043\175"
	"\272\310\043\261\267\217\173\333\232\113\125\302\031\036\313\263"
	"\151\117\020\365\246\356\175\076\362\235\333\233\027\146\260\254"
	"\333\107\373\062\157\323\011\107\015\163\127\044\177\311\047\200"
	"\056\033\371\155\030\073\011\214\007\334\104\000\247\317\163\147"
	"\367\251\077\304\171\226\071\301\037\256\212\361\243\156\120\031"
	"\211\371\107\322\266\345\207\315\227\004\275\313\330\326\073\016"
	"\071\204\203\107\165\043\352\210\323\350\243\375\074\220\170\162"
	"\244\266\021\357\334\053\044\044\157\131\212\203\054\237\214\022"
	"\133\260\167\376\242\312\217\065\132\243\351\342\232\134\271\161"
	"\172\126\253\174\243\335\301\274\077\351\374\100\223\030\361\035"
	"\277\237\165\064\154\267\045\316\046\262\322\130\014\105\304\042"
	"\326\203\015\122\001\026\130\173\312\256\041\135\322\150\252\107"
	"\123\053\114\230\042\376\167\041\203\375\135\023\017\061\037\121"
	"\152\202\167\034\114\216\200\270\105\300\175\342\111\215\117\370"
	"\230\314\124\045\041\144\371\217\342\137\337\337\177\261\006\024"
	"\114\062\240\275\366\153\051\112\225\237\274\004\225\341\010\022"
	"\336\152\331\130\226\125\277\210\371\251\371\372\100\107\236\313"
	"\363\235\134\010\131\151\330\107\235\040\364\267\207\351\143\274"
	"\076\075\154\305\115\132\021\074\346\274\242\047\336\056\076\263"
	"\305\005\072\316\130\121\077\243\372\326\007\363\324\114\233\354"
	"\362\361\023\275\331\166\330\334\167\206\364\226\116\004\260\256"
	"\242\063\363\077\044\324\237\143\066\027\072\036\332\177\250\067"
	"\305\052\371\137\226\015\364\316\106\236\276\010\030\162\306\262"
	"\244\067\003\157\067\164\367\073\171\131\330\327\155\326\031\067"
	"\327\303\137\365\144\024\372\041\135\210\074\362\074\066\216\363"
	"\277\161\257\143\021\200\163\344\273\115\150\165\210\334\161\312"
	"\312\055\352\237\217\134\351\156\324\026\321\041\347\265\271\327"
	"\026\037\130\142\043\170\277\010\024\214\140\023\040\060\353\376"
	"\054\353\175\055\023\137\156\262\252\276\143\117\325\206\323\043"
	"\044\052\061\144\214\111\063\024\032\065\060\211\371\021\302\132"
	"\073\311\302\112\351\227\214\263\027\343\241\077\243\042\131\126"
	"\247\011\237\153\353\005\341\254\050\163\332\336\245\257\316\204"
	"\013\146\010\243\074\361\213\115\206\017\221\343\002\046\200\066"
	"\161\217\206\276\107\313\160\273\166\024\031\227\035\205\104\235"
	"\303\040\161\057\246\332\100\017\317\012\360\076\361\172\106\014"
	"\267\346\357\044\022\172\011\343\274\032\020\213\146\062\256\355"
	"\347\163\166\116\134\122\301\114\240\153\045\333\301\357\362\177"
	"\324\377\103\304\352\113\247\246\145\267\061\313\351\340\271\321"
	"\123\057\037\260\202\341\375\043\115\042\377\016\022\361\216\346"
	"\361\321\253\333\035\122\201\202\012\263\116\363"
#define      msg2_z	19
#define      msg2	((&data[2101]))
	"\131\351\301\071\225\043\062\140\377\366\023\225\035\242\245\233"
	"\240\332\163\350\066\345"
#define      rlax_z	1
#define      rlax	((&data[2123]))
	"\134"
#define      opts_z	1
#define      opts	((&data[2124]))
	"\154"
#define      msg1_z	42
#define      msg1	((&data[2134]))
	"\313\315\262\262\277\203\135\232\241\227\112\242\037\114\311\055"
	"\124\136\012\322\263\352\027\350\024\172\104\070\303\116\227\023"
	"\317\142\163\020\131\354\154\377\235\366\334\363\253\153\246\207"
	"\125\262\275\257"
#define      date_z	1
#define      date	((&data[2177]))
	"\230"
#define      inlo_z	3
#define      inlo	((&data[2178]))
	"\120\343\123"
#define      lsto_z	1
#define      lsto	((&data[2181]))
	"\166"
#define      tst1_z	22
#define      tst1	((&data[2186]))
	"\345\151\036\173\112\335\055\003\330\254\222\311\156\000\133\220"
	"\231\267\212\336\037\056\341\167\020\141\106\063"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !defined(TRACEABLE)

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !defined(TRACEABLE) */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !defined(TRACEABLE)
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
